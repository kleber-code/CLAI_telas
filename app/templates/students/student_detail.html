{% extends "base.html" %}
{% block title %}Detalhes do Aluno - CLAI{% endblock %}

{% block page_heading %}Detalhes do Aluno{% endblock %}

{% block content %}
<div class="row my-4">
    <div class="col-lg-10 mx-auto">
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white py-3">
                <h5 class="mb-0">Informações do Aluno</h5>
            </div>
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-3 text-center mb-3 mb-md-0">
                        <img src="{{ url_for('static', filename='img/student_pics/' + student.student_picture) }}" alt="Foto do Aluno" class="img-fluid rounded-circle border border-2 border-primary" style="width: 150px; height: 150px; object-fit: cover;">
                        <h4 class="mt-3 mb-1 text-primary">{{ student.name }}</h4>
                        <p class="text-muted small">{{ student.matricula }}</p>
                    </div>
                    <div class="col-md-9">
                        <h5 class="mb-3 text-primary">Dados Pessoais e Acadêmicos</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1"><strong>Data de Nascimento:</strong> {{ student.dob.strftime('%d/%m/%Y') }}</p>
                                <p class="mb-1"><strong>CID:</strong> {{ student.cid if student.cid else 'N/A' }}</p>
                                <p class="mb-1"><strong>E-mail:</strong> {{ student.email if student.email else 'N/A' }}</p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1"><strong>Telefone:</strong> {{ student.phone if student.phone else 'N/A' }}</p>
                                <p class="mb-1"><strong>Turma:</strong> {{ student.grade if student.grade else 'N/A' }}</p>
                                <p class="mb-1"><strong>Curso:</strong> {{ student.course if student.course else 'N/A' }}</p>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <p class="mb-1"><strong>Necessidades Específicas:</strong> {{ student.specific_needs_description if student.specific_needs_description else 'N/A' }}</p>
                            </div>
                        </div>
                        
                        <h5 class="mb-3 mt-4 text-primary">Informações do Responsável</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1"><strong>Nome:</strong> {{ student.responsible_name if student.responsible_name else 'N/A' }}</p>
                                <p class="mb-1"><strong>Telefone:</strong> {{ student.responsible_phone if student.responsible_phone else 'N/A' }}</p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1"><strong>E-mail:</strong> {{ student.responsible_email if student.responsible_email else 'N/A' }}</p>
                            </div>
                        </div>

                        <div class="mt-4 d-flex justify-content-end gap-2">
                            <a href="{{ url_for('main.edit_student', student_id=student.id) }}" class="btn btn-warning" title="Editar informações do aluno"><i class="bi bi-pencil-square me-2"></i>Editar Aluno</a>
                            <a href="{{ url_for('main.add_observation', student_id=student.id) }}" class="btn btn-success" title="Adicionar nova observação"><i class="bi bi-plus-circle me-2"></i>Adicionar Observação</a>
                            <a href="{{ url_for('main.list_students') }}" class="btn btn-secondary" title="Voltar para a lista de alunos"><i class="bi bi-arrow-left me-2"></i>Voltar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow mt-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-journal-text me-2"></i>Histórico de Observações</h5>
            </div>
            <div class="card-body">
                {% if observations %}
                    <div class="list-group">
                        {% for obs in observations %}
                            <li class="list-group-item list-group-item-action flex-column align-items-start mb-2">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1 text-primary">Observação em {{ obs.date.strftime('%d/%m/%Y') }}</h6>
                                    <small class="text-muted">Pedagoga: {{ obs.pedagogue.name }}</small>
                                </div>
                                <p class="mb-1">{{ obs.observation_text }}</p>
                                {% if obs.justification %}
                                    <small class="text-muted">Justificativa (Edição): {{ obs.justification }}</small>
                                {% endif %}
                                <div class="mt-2 text-end">
                                    <a href="{{ url_for('main.edit_observation', student_id=student.id, observation_id=obs.id) }}" class="btn btn-sm btn-info" title="Editar esta observação"><i class="bi bi-pencil me-2"></i>Editar</a>
                                </div>
                            </li>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted">Nenhuma observação registrada para este aluno.</p>
                {% endif %}
            </div>
        </div>

        <div class="card shadow mt-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-calendar-check me-2"></i>Histórico de Frequência</h5>
            </div>
            <div class="card-body">
                {% if attendance_records %}
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">Data</th>
                                    <th scope="col">Status</th>
                                    <th scope="col">Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in attendance_records %}
                                <tr>
                                    <td>{{ record.date.strftime('%d/%m/%Y') }}</td>
                                    <td>
                                        {% if record.status == 'present' %}
                                            <span class="badge bg-success">Presente</span>
                                        {% elif record.status == 'absent' %}
                                            <span class="badge bg-danger">Ausente</span>
                                        {% elif record.status == 'justified_absent' %}
                                            <span class="badge bg-warning text-dark">Ausência Justificada</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{{ url_for('main.edit_attendance', attendance_id=record.id) }}" class="btn btn-sm btn-outline-primary me-1" title="Editar registro de frequência">
                                            <i class="bi bi-pencil-square"></i>
                                        </a>
                                        <form action="{{ url_for('main.delete_attendance', attendance_id=record.id) }}" method="POST" style="display:inline;">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Tem certeza que deseja excluir este registro de frequência?');" title="Excluir registro de frequência">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">Nenhum registro de frequência para este aluno.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}